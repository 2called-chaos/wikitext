# depend
# Additional material for Makefile
#
# Copyright 2007 Wincent Colaiuta

ANTLR_CMD = java org.antlr.Tool

# ignore __.g files created by ANTLR
grammars := $(filter-out %__.g, $(wildcard *.g))

lexer_headers := $(grammars:.g=Lexer.h)
lexer_implementations := $(grammars:.g=Lexer.c)
lexer_sources := $(lexer_headers) $(lexer_implementations)

antlr_sources := $(lexer_sources)

.PHONY : antlr
antlr : $(antlr_sources)

WikiTextLexer.h: WikiText.g
	$(ANTLR_CMD) WikiText.g
WikiTextLexer.c: WikiText.g
	$(ANTLR_CMD) WikiText.g

# TODO: recompile wiki_text.c whenever WikiTextLexer.h updates
# not sure how to do this without rewriting the original rules generated by mkmf
#wiki_text.c: WikiText.g

$(DLLIB) : $(antlr_sources)

CFLAGS += -std=gnu99
